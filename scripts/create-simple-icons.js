const fs = require('fs');
const path = require('path');

// Create a simple base64 PNG icon (1x1 blue pixel)
const createSimplePNG = (size) => {
  // This is a very basic approach - in production you'd want to use a proper image library
  // For now, we'll create a simple blue square as a data URL
  const canvas = `
    <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
      <rect width="${size}" height="${size}" fill="#3b82f6"/>
      <text x="50%" y="50%" font-family="Arial" font-size="${Math.floor(size * 0.4)}" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="white">A</text>
    </svg>
  `;
  
  return canvas;
};

// Icon sizes needed for PWA
const iconSizes = [72, 96, 128, 144, 152, 180, 192, 384, 512];

// Create icons directory if it doesn't exist
const iconsDir = path.join(__dirname, '..', 'public', 'icons');
if (!fs.existsSync(iconsDir)) {
  fs.mkdirSync(iconsDir, { recursive: true });
}

// For now, let's create placeholder files and a note
const readmeContent = `# PWA Icons

This directory should contain the following PNG icon files:

${iconSizes.map(size => `- icon-${size}x${size}.png`).join('\n')}

## How to create the icons:

1. Use the SVG files generated by generate-pwa-icons.js
2. Convert them to PNG using an online converter or image editor
3. Save them with the exact filenames listed above
4. Ensure they are square PNG images with the specified dimensions

## Quick creation method:

You can use the icon-converter.html file in the public directory to generate PNG files from the SVG templates.

## Icon requirements:

- Format: PNG
- Background: Blue gradient (#3b82f6 to #1d4ed8)
- Content: White "A" letter in the center
- Shape: Rounded rectangle (20% border radius)
- All icons should be square with the specified dimensions
`;

fs.writeFileSync(path.join(iconsDir, 'README.md'), readmeContent);

// Create a simple HTML file that can be used to generate the icons
const iconGeneratorHTML = `<!DOCTYPE html>
<html>
<head>
    <title>Astrid PWA Icon Generator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .icon-item { text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        canvas { border: 1px solid #ccc; margin: 5px; }
        .download-btn { margin: 5px; padding: 5px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .download-btn:hover { background: #1d4ed8; }
        h1 { color: #333; }
        .instructions { background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Astrid PWA Icon Generator</h1>
        
        <div class="instructions">
            <h3>Instructions:</h3>
            <ol>
                <li>Click "Download" next to each icon size</li>
                <li>Save the files in the <code>public/icons/</code> directory</li>
                <li>Use the exact filenames shown below each icon</li>
            </ol>
        </div>
        
        <div class="icon-grid">
            ${iconSizes.map(size => `
                <div class="icon-item">
                    <h3>${size}Ã—${size}</h3>
                    <canvas id="canvas-${size}" width="${size}" height="${size}"></canvas>
                    <br>
                    <button class="download-btn" onclick="downloadIcon(${size})">Download</button>
                    <br>
                    <small>icon-${size}x${size}.png</small>
                </div>
            `).join('')}
        </div>
    </div>

    <script>
        const iconSizes = [${iconSizes.join(', ')}];
        
        function createIcon(canvas, size) {
            const ctx = canvas.getContext('2d');
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, size, size);
            gradient.addColorStop(0, '#3b82f6');
            gradient.addColorStop(1, '#1d4ed8');
            
            // Draw rounded rectangle background
            const radius = size * 0.2;
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(0, 0, size, size, radius);
            ctx.fill();
            
            // Draw "A" text
            ctx.fillStyle = 'white';
            ctx.font = \`bold \${Math.floor(size * 0.4)}px Arial, sans-serif\`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('A', size / 2, size / 2);
        }
        
        function downloadIcon(size) {
            const canvas = document.getElementById(\`canvas-\${size}\`);
            const link = document.createElement('a');
            link.download = \`icon-\${size}x\${size}.png\`;
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // Generate all icons on page load
        iconSizes.forEach(size => {
            const canvas = document.getElementById(\`canvas-\${size}\`);
            createIcon(canvas, size);
        });
    </script>
</body>
</html>`;

fs.writeFileSync(path.join(__dirname, '..', 'public', 'pwa-icon-generator.html'), iconGeneratorHTML);

console.log('PWA Icon setup complete!');
console.log('');
console.log('Next steps:');
console.log('1. Open public/pwa-icon-generator.html in your browser');
console.log('2. Click "Download" for each icon size');
console.log('3. Save all files in the public/icons/ directory');
console.log('4. The icons will be automatically used by the PWA manifest');
console.log('');
console.log('Generated files:');
console.log('- public/icons/README.md (instructions)');
console.log('- public/pwa-icon-generator.html (icon generator)');
